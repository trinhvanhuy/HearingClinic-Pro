version: '3.8'

services:
  mongo:
    image: mongo:7.0
    container_name: hearing-clinic-mongo
    restart: unless-stopped
    ports:
      - "27018:27017"
    volumes:
      - mongo-data:/data/db
    environment:
      MONGO_INITDB_DATABASE: hearing-clinic-db
    networks:
      - hearing-clinic-network

  parse-server:
    build:
      context: .
      dockerfile: docker/Dockerfile.parse
    container_name: hearing-clinic-parse-server
    restart: unless-stopped
    ports:
      - "1338:1337"
    environment:
      PARSE_APP_ID: ${PARSE_APP_ID:-hearing-clinic-app-id}
      PARSE_MASTER_KEY: ${PARSE_MASTER_KEY:-your-master-key-change-this}
      PARSE_SERVER_URL: ${PARSE_SERVER_URL:-http://localhost:1338/parse}
      DATABASE_URI: mongodb://mongo:27017/hearing-clinic-db
      PARSE_SERVER_CLOUD: /parse/cloud/main.js
      PORT: 1337
      HOST: 0.0.0.0
      PARSE_DASHBOARD_USER: ${PARSE_DASHBOARD_USER:-admin}
      PARSE_DASHBOARD_PASSWORD: ${PARSE_DASHBOARD_PASSWORD:-admin}
    volumes:
      - ./src/cloud:/parse/cloud
      - ./src:/app/src
    depends_on:
      - mongo
    networks:
      - hearing-clinic-network

volumes:
  mongo-data:

networks:
  hearing-clinic-network:
    driver: bridge

